---
title: Vef쬵칩nustur og gagnagrunnar
---

## Vef쬵칩nustur og gagnagrunnar

### Vefforritun

### 칍lafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

## D칳nam칤skar fyrirspurnir

* Stundum 쬿rfum vi칧 a칧 gr칤pa til 쬰ss a칧 b칰a til fyrirspurnir me칧 strengjame칧h칬ndlun 游뗻
* Ekki allt getur fari칧 칤 prepared statement, t.d. ef vi칧 viljum d칳nam칤skt breyta `ORDER BY`
* E칧a gera `PATCH` k칬ll
* **VER칋UM A칋 FARA VARLEGA**, svona k칩칧i er einstaklega vi칧kv칝mur fyrir SQL injection

***

<!-- eslint-disable no-unused-vars, no-undef -->

```javascript
async function list(req, res) {
  const asc = req.query.order === 'ASC';

  // r칬칧um e. id 칤 ascending (ASC) e칧a
  // descending (DESC) r칬칧 eftir 쭀칤
  // hvort boolean gildi s칠 satt e칧a ekki
  // Notum ekkert fr치 notanda 칤 d칳nam칤skr칤
  // fyrirsp. GETUM A칋EINS HAFT TV칐 GILDI!
  const order = asc ? 'id ASC' : 'id DESC';

  const q = `
    SELECT * FROM items ORDER BY ${order}`;

  const result = await query(q);
}
```

***

## F칝rslur b칰nar til

* Getum nota칧 `RETURNING` syntax 칤 postgres til a칧 f치 til baka f칝rslu sem b칰in var til
* 룟rfum ekki a칧ra fyrirspurn til a칧 fletta upp reitum eins og `id` e칧a `created`
* `INSERT INTO items (text) VALUES ('foo') RETURNING id, text, created;`

***

## F칝rslum eytt

* Getum reynt a칧 ey칧a f칝rslu sem er ekki til
  * 룟rfum samt a칧 a칧skilja 치 milli f칝rslu sem var til og eytt
  * og f칝rslu sem var ekki til...
* 룐gar 치tt var vi칧 ra칧ir mun `rowCount` skila fj칬lda ra칧a sem 치tt var vi칧

***

<!-- eslint-disable no-unused-vars, no-undef -->

```javascript
async function deleteRow(id) {
  const q = `
    DELETE FROM todos WHERE id = $1`;

  const result = await query(q, [id]);

  // true ef f칝rslu eytt, annars false
  return result.rowCount === 1;
}
```
